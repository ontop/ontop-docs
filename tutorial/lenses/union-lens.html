<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Union Lens | Ontop</title>
    <meta name="generator" content="VuePress 1.8.2">
    <meta name="description" content="">
    <link rel="preload" href="/assets/css/0.styles.2b9f24ec.css" as="style"><link rel="preload" href="/assets/js/app.1383b214.js" as="script"><link rel="preload" href="/assets/js/2.ce8d9015.js" as="script"><link rel="preload" href="/assets/js/92.2f52313f.js" as="script"><link rel="prefetch" href="/assets/js/10.2e10abfc.js"><link rel="prefetch" href="/assets/js/11.9c479812.js"><link rel="prefetch" href="/assets/js/12.5ae33baf.js"><link rel="prefetch" href="/assets/js/13.9330117e.js"><link rel="prefetch" href="/assets/js/14.cabf7cc1.js"><link rel="prefetch" href="/assets/js/15.8ec0d624.js"><link rel="prefetch" href="/assets/js/16.6ea3c048.js"><link rel="prefetch" href="/assets/js/17.23c168f3.js"><link rel="prefetch" href="/assets/js/18.1de16b6c.js"><link rel="prefetch" href="/assets/js/19.c55473af.js"><link rel="prefetch" href="/assets/js/20.8c67cb7d.js"><link rel="prefetch" href="/assets/js/21.101f0364.js"><link rel="prefetch" href="/assets/js/22.c12075f0.js"><link rel="prefetch" href="/assets/js/23.43b5e0ca.js"><link rel="prefetch" href="/assets/js/24.e8f61543.js"><link rel="prefetch" href="/assets/js/25.2396cff3.js"><link rel="prefetch" href="/assets/js/26.d98cd04f.js"><link rel="prefetch" href="/assets/js/27.906526eb.js"><link rel="prefetch" href="/assets/js/28.94f3980e.js"><link rel="prefetch" href="/assets/js/29.6957445c.js"><link rel="prefetch" href="/assets/js/3.4c4f4577.js"><link rel="prefetch" href="/assets/js/30.a3858dfb.js"><link rel="prefetch" href="/assets/js/31.e0f4dd4b.js"><link rel="prefetch" href="/assets/js/32.bbc94ac1.js"><link rel="prefetch" href="/assets/js/33.45b3ef2c.js"><link rel="prefetch" href="/assets/js/34.5c6a9e4c.js"><link rel="prefetch" href="/assets/js/35.0d111cf6.js"><link rel="prefetch" href="/assets/js/36.c44deccc.js"><link rel="prefetch" href="/assets/js/37.bb881e0e.js"><link rel="prefetch" href="/assets/js/38.4b35dae5.js"><link rel="prefetch" href="/assets/js/39.4be92c4e.js"><link rel="prefetch" href="/assets/js/4.65c6f7cd.js"><link rel="prefetch" href="/assets/js/40.95a2c8af.js"><link rel="prefetch" href="/assets/js/41.8783e3b4.js"><link rel="prefetch" href="/assets/js/42.3110384f.js"><link rel="prefetch" href="/assets/js/43.2f553706.js"><link rel="prefetch" href="/assets/js/44.e2d6c57b.js"><link rel="prefetch" href="/assets/js/45.5291c80e.js"><link rel="prefetch" href="/assets/js/46.95be6bab.js"><link rel="prefetch" href="/assets/js/47.ad1074c4.js"><link rel="prefetch" href="/assets/js/48.0d6b015c.js"><link rel="prefetch" href="/assets/js/49.f7c32909.js"><link rel="prefetch" href="/assets/js/5.e8e9de00.js"><link rel="prefetch" href="/assets/js/50.553bcc3d.js"><link rel="prefetch" href="/assets/js/51.f97daa0e.js"><link rel="prefetch" href="/assets/js/52.c6007dd0.js"><link rel="prefetch" href="/assets/js/53.531ae014.js"><link rel="prefetch" href="/assets/js/54.4886bdef.js"><link rel="prefetch" href="/assets/js/55.8d8bd329.js"><link rel="prefetch" href="/assets/js/56.7df4d26d.js"><link rel="prefetch" href="/assets/js/57.875eb1b7.js"><link rel="prefetch" href="/assets/js/58.84614c17.js"><link rel="prefetch" href="/assets/js/59.8a99da0a.js"><link rel="prefetch" href="/assets/js/6.e48edabd.js"><link rel="prefetch" href="/assets/js/60.afe27b10.js"><link rel="prefetch" href="/assets/js/61.c3d9a46e.js"><link rel="prefetch" href="/assets/js/62.bc19bdad.js"><link rel="prefetch" href="/assets/js/63.3958e67e.js"><link rel="prefetch" href="/assets/js/64.346036f0.js"><link rel="prefetch" href="/assets/js/65.b3b941a0.js"><link rel="prefetch" href="/assets/js/66.c44124a7.js"><link rel="prefetch" href="/assets/js/67.64e2a825.js"><link rel="prefetch" href="/assets/js/68.e10a3527.js"><link rel="prefetch" href="/assets/js/69.6d63de0c.js"><link rel="prefetch" href="/assets/js/7.7db7f35e.js"><link rel="prefetch" href="/assets/js/70.b9f43dfa.js"><link rel="prefetch" href="/assets/js/71.0cfd9227.js"><link rel="prefetch" href="/assets/js/72.6b1462d3.js"><link rel="prefetch" href="/assets/js/73.fb51a3b3.js"><link rel="prefetch" href="/assets/js/74.844910a1.js"><link rel="prefetch" href="/assets/js/75.b3759ae1.js"><link rel="prefetch" href="/assets/js/76.a37b539d.js"><link rel="prefetch" href="/assets/js/77.c19a7ca8.js"><link rel="prefetch" href="/assets/js/78.70341003.js"><link rel="prefetch" href="/assets/js/79.3b685102.js"><link rel="prefetch" href="/assets/js/8.a24e3ea0.js"><link rel="prefetch" href="/assets/js/80.64f8b67b.js"><link rel="prefetch" href="/assets/js/81.e950ffd8.js"><link rel="prefetch" href="/assets/js/82.58d62800.js"><link rel="prefetch" href="/assets/js/83.f05ae714.js"><link rel="prefetch" href="/assets/js/84.0fe69a4f.js"><link rel="prefetch" href="/assets/js/85.2663cb75.js"><link rel="prefetch" href="/assets/js/86.e4a298ad.js"><link rel="prefetch" href="/assets/js/87.69e9cfa7.js"><link rel="prefetch" href="/assets/js/88.d06c7d2f.js"><link rel="prefetch" href="/assets/js/89.089b6b8c.js"><link rel="prefetch" href="/assets/js/9.2397fef4.js"><link rel="prefetch" href="/assets/js/90.2da9f11c.js"><link rel="prefetch" href="/assets/js/91.07b1c0b4.js"><link rel="prefetch" href="/assets/js/93.b5c01828.js"><link rel="prefetch" href="/assets/js/94.e4685204.js"><link rel="prefetch" href="/assets/js/95.6f84c28c.js"><link rel="prefetch" href="/assets/js/96.b79f0927.js"><link rel="prefetch" href="/assets/js/97.dc3e9026.js"><link rel="prefetch" href="/assets/js/98.92948a43.js">
    <link rel="stylesheet" href="/assets/css/0.styles.2b9f24ec.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Ontop</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/guide/" class="nav-link">
  Guide
</a></div><div class="nav-item"><a href="/tutorial/" class="nav-link router-link-active">
  Tutorial
</a></div><div class="nav-item"><a href="/download/" class="nav-link">
  Download
</a></div><div class="nav-item"><a href="/community/" class="nav-link">
  Community
</a></div><div class="nav-item"><a href="/research/" class="nav-link">
  Research
</a></div><div class="nav-item"><a href="/dev/" class="nav-link">
  Dev
</a></div><div class="nav-item"><a href="/jobs/" class="nav-link">
  Work with us
</a></div> <a href="https://github.com/ontop/ontop" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/guide/" class="nav-link">
  Guide
</a></div><div class="nav-item"><a href="/tutorial/" class="nav-link router-link-active">
  Tutorial
</a></div><div class="nav-item"><a href="/download/" class="nav-link">
  Download
</a></div><div class="nav-item"><a href="/community/" class="nav-link">
  Community
</a></div><div class="nav-item"><a href="/research/" class="nav-link">
  Research
</a></div><div class="nav-item"><a href="/dev/" class="nav-link">
  Dev
</a></div><div class="nav-item"><a href="/jobs/" class="nav-link">
  Work with us
</a></div> <a href="https://github.com/ontop/ontop" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Tutorial</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/tutorial/" aria-current="page" class="sidebar-link">Presentation</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Basics</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/tutorial/basic/setup.html" class="sidebar-link">Database and Ontop Setup</a></li><li><a href="/tutorial/basic/university-1.html" class="sidebar-link">First data source: university 1</a></li><li><a href="/tutorial/basic/university-2.html" class="sidebar-link">Second data source: university 2</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Endpoint</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/tutorial/endpoint/" class="sidebar-link">Deploying a SPARQL endpoint</a></li><li><a href="/tutorial/endpoint/endpoint-cli.html" class="sidebar-link">Setting up an Ontop SPARQL endpoint with Ontop CLI</a></li><li><a href="/tutorial/endpoint/endpoint-docker.html" class="sidebar-link">Setting up an Ontop SPARQL endpoint with Docker</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Interact</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/tutorial/interact/cli.html" class="sidebar-link">Interact with an Ontop SPARQL Endpoint</a></li><li><a href="/tutorial/interact/jupyter.html" class="sidebar-link">Use Jupyter Notebook with an Ontop SPARQL endpoint</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Mapping</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/tutorial/mapping/" class="sidebar-link">Second session: Mapping Engineering</a></li><li><a href="/tutorial/mapping/primary-keys.html" class="sidebar-link">Role of primary keys (unique constraints)</a></li><li><a href="/tutorial/mapping/foreign-keys.html" class="sidebar-link">Role of foreign keys</a></li><li><a href="/tutorial/mapping/uri-templates.html" class="sidebar-link">Choice of the IRI templates</a></li><li><a href="/tutorial/mapping/existential.html" class="sidebar-link">Bonus: existential reasoning</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Federation</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/tutorial/federation/" class="sidebar-link">Federating multiple databases</a></li><li><a href="/tutorial/federation/denodo/" class="sidebar-link">Ontop with Denodo</a></li><li><a href="/tutorial/federation/dremio/" class="sidebar-link">Ontop with Dremio</a></li><li><a href="/tutorial/federation/teiid/" class="sidebar-link">Ontop with Teiid</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Lenses</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/tutorial/lenses/" aria-current="page" class="sidebar-link">Using Ontop Lenses</a></li><li><a href="/tutorial/lenses/setup.html" class="sidebar-link">Database and Ontop Setup</a></li><li><a href="/tutorial/lenses/basic-lens.html" class="sidebar-link">Basic Lens</a></li><li><a href="/tutorial/lenses/join-lens.html" class="sidebar-link">Join Lens</a></li><li><a href="/tutorial/lenses/union-lens.html" aria-current="page" class="active sidebar-link">Union Lens</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/tutorial/lenses/union-lens.html#relations-with-the-same-schema" class="sidebar-link">Relations with the same schema</a></li><li class="sidebar-sub-header"><a href="/tutorial/lenses/union-lens.html#relations-with-different-schemas" class="sidebar-link">Relations with different schemas</a></li></ul></li><li><a href="/tutorial/lenses/flatten-lens.html" class="sidebar-link">Flatten Lens</a></li><li><a href="/tutorial/lenses/sql-lens.html" class="sidebar-link">SQL Lens</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Others</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/tutorial/external-tutorials.html" class="sidebar-link">External tutorials</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="union-lens"><a href="#union-lens" class="header-anchor">#</a> Union Lens</h1> <p>Unions lenses can be used to concatenate multiple relations with the same schema into one. Additionally, a <em>provenance</em> field can be added to each row, determining the source relation the row originates from.</p> <p>For this example, we will look at the tables <code>nature_exhibits</code>, <code>historical_exhibits</code> and <code>art_exhibits</code> from the DuckDB database. We want to combine them into a single relation containing all exhibits.</p> <p>The tables <code>nature_exhibits</code> and <code>historical_exhibits</code> have the following schema:</p> <table><thead><tr><th>column</th> <th>type</th></tr></thead> <tbody><tr><td>exhibit_id</td> <td>integer</td></tr> <tr><td>name</td> <td>string</td></tr> <tr><td>museum_id</td> <td>integer</td></tr></tbody></table> <p>The table <code>art_exhibits</code> has the following schema:</p> <table><thead><tr><th>column</th> <th>type</th></tr></thead> <tbody><tr><td>exhibit_id</td> <td>integer</td></tr> <tr><td>name</td> <td>string</td></tr> <tr><td>artist_name</td> <td>string</td></tr> <tr><td>museum_id</td> <td>integer</td></tr></tbody></table> <p>For each table, <code>exhibit_id</code> is a primary key and <code>museum_id</code> is a foreign key, referencing the table <code>museums</code>.</p> <h2 id="relations-with-the-same-schema"><a href="#relations-with-the-same-schema" class="header-anchor">#</a> Relations with the same schema</h2> <p>This concatenation can be achieved using a union lens. However, as all base relations of a union lens must have the exact same columns, we will only be working on the tables <code>nature_exhibits</code> and <code>historical_exhibits</code> at first.</p> <p>The union lens has the following structure:</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>String<span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;unionRelations&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>String<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;makeDistinct&quot;</span><span class="token operator">:</span> boolean<span class="token punctuation">,</span>
    <span class="token property">&quot;provenanceColumn&quot;</span><span class="token operator">:</span> String<span class="token punctuation">,</span>
    <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;UnionLens&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Here, <code>unionRelations</code> is a list of relations that should be concatenated, <code>makeDistinct</code> indicates if a distinct constraint should be enforced on the result, and <code>provenanceColumn</code> is an optional parameter, indicating the name of the provenance column in the result, which tells us what relation each row originated from.</p> <p>As the tables <code>nature_exhibits</code> and <code>historical_exhibits</code> have the same set of columns, we can reference them from a union lens to create a new, concatenated view.</p> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>The columns of all tables used by a union lens must be <em>exactly</em> equal. Their columns must have <em>the same names</em> and the <strong>exact</strong> <em>same data types</em>. The order of the columns does not matter.</p></div> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;relations&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;lenses&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;all_exhibits&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token property">&quot;unionRelations&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token punctuation">[</span><span class="token string">&quot;historical_exhibits&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token punctuation">[</span><span class="token string">&quot;nature_exhibits&quot;</span><span class="token punctuation">]</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token property">&quot;provenanceColumn&quot;</span><span class="token operator">:</span> ...<span class="token punctuation">,</span>
            <span class="token property">&quot;makeDistinct&quot;</span><span class="token operator">:</span> ...<span class="token punctuation">,</span>
            <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;UnionLens&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The remaining fields are <code>provenanceColumn</code> and <code>makeDistinct</code>. As we do not expect the entries of any of the tables to be equal, we can just neglect the <code>makeDistinct</code> parameter. To preserve the source of each entry, we want to include a provenance column. We can call it <code>exhibit_type</code>. This results in the following <code>lenses.json</code> file:</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;relations&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;lenses&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;all_exhibits&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token property">&quot;unionRelations&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token punctuation">[</span><span class="token string">&quot;historical_exhibits&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token punctuation">[</span><span class="token string">&quot;nature_exhibits&quot;</span><span class="token punctuation">]</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token property">&quot;provenanceColumn&quot;</span><span class="token operator">:</span> <span class="token string">&quot;exhibit_type&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;UnionLens&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">NOTE</p> <p>If the <code>provenanceColumn</code> field is not provided, then no information on the source relation will be preserved for the concatenated rows. If the field <code>makeDistinct</code> is not provided, its default value is assumed to be <code>false</code>.</p></div> <div class="custom-block tip"><p class="custom-block-title">NOTE</p> <p>Including a <code>provenanceColumn</code> in a UnionLens where each of the source relations is distinct will render the <code>makeDistinct</code> field redundant. This is because, under a union, the composite uniqueness constraint <code>(provenanceColumns, childUniquenessConstraint)</code> will always hold. On the other hand, if no provenance column is included, then uniqueness constraints from the base relations will be lost, as there is no guarantee that a specific value does not appear again in a different table.</p></div> <h3 id="mapping"><a href="#mapping" class="header-anchor">#</a> Mapping</h3> <p>Now, let us use this lens definition in our mapping. Starting from the mapping template file, add the following mapping entry:</p> <div class="language-obda extra-class"><pre class="language-text"><code>mappingId	MAPID-exhibits
target		data:exhibit/{exhibit_id} a :Exhibit ; :name {name} ; :displayedIn data:museum/{museum_id} ; :exhibitType {exhibit_type} .
source		SELECT exhibit_id, name, museum_id, exhibit_type FROM lenses.all_exhibits;
</code></pre></div><p>Starting the Ontop SPARQL endpoint using this mapping and lens file, we can now run the SPARQL query:</p> <div class="language-SPARQL extra-class"><pre class="language-sparql"><code><span class="token keyword">PREFIX</span> <span class="token function"><span class="token prefix"><span class="token punctuation">:</span></span></span> <span class="token url"><span class="token punctuation">&lt;</span>http://example.org/museum_kg/<span class="token punctuation">&gt;</span></span>
<span class="token keyword">SELECT</span> <span class="token variable">?name</span> <span class="token variable">?type</span> <span class="token keyword">WHERE</span> <span class="token punctuation">{</span>
    <span class="token variable">?exhibit</span> <span class="token keyword">a</span> <span class="token function"><span class="token prefix"><span class="token punctuation">:</span></span><span class="token local-name">Exhibit</span></span> <span class="token punctuation">.</span>
    <span class="token variable">?exhibit</span> <span class="token function"><span class="token prefix"><span class="token punctuation">:</span></span><span class="token local-name">name</span></span> <span class="token variable">?name</span> <span class="token punctuation">.</span>
    <span class="token variable">?exhibit</span> <span class="token function"><span class="token prefix"><span class="token punctuation">:</span></span><span class="token local-name">exhibitType</span></span> <span class="token variable">?type</span> <span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div><p>This should result in a set of exhibit names that have the values <code>historical_exhibits</code> and <code>nature_exhibits</code> as their exhibit type.</p> <h2 id="relations-with-different-schemas"><a href="#relations-with-different-schemas" class="header-anchor">#</a> Relations with different schemas</h2> <p>If we further want to include the table <code>art_exhibits</code> to the union lens, we cannot just add it to the list of <code>unionRelations</code>. This is because it has one additional column, <code>artist_name</code>, that does not appear in the other tables.
To work around this issue, we can take advantage of basic lenses, putting them &quot;underneath&quot; the union lens, to ensure the equality of columns.</p> <p>There are two possibilities to achieve this:</p> <ol><li>Hide the conflicting column(s) from its/their table(s)</li> <li>Add the conflicting column(s) to the tables that do not include them.</li></ol> <p>To retain a maximum of information, we will choose the second approach for this example. That means, that we have to construct basic lenses to add the column <code>artist_name</code> to the tables <code>historical_exhibits</code> and <code>nature_exhibits</code>. One possible way to achieve this is by adding new columns that have <code>NULL</code> as their expressions.</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;relations&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;lenses&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;historical_exhibits_extended&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token property">&quot;baseRelation&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;historical_exhibits&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token property">&quot;columns&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token property">&quot;added&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                    <span class="token punctuation">{</span>
                        <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;artist_name&quot;</span><span class="token punctuation">,</span>
                        <span class="token property">&quot;expression&quot;</span><span class="token operator">:</span> <span class="token string">&quot;'None'&quot;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token property">&quot;hidden&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;BasicLens&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>After doing the same for the <code>nature_exhibits</code> table, referencing the new extended lenses from the union lens, and adding <code>art_exhibits</code> as one of its union relations, get the following lens file:</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;relations&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;lenses&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;historical_exhibits_extended&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token property">&quot;baseRelation&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;historical_exhibits&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token property">&quot;columns&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token property">&quot;added&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                    <span class="token punctuation">{</span>
                        <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;artist_name&quot;</span><span class="token punctuation">,</span>
                        <span class="token property">&quot;expression&quot;</span><span class="token operator">:</span> <span class="token string">&quot;'None'&quot;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token property">&quot;hidden&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;BasicLens&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
            <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;lenses&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;nature_exhibits_extended&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token property">&quot;baseRelation&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;nature_exhibits&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token property">&quot;columns&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token property">&quot;added&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                    <span class="token punctuation">{</span>
                        <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;artist_name&quot;</span><span class="token punctuation">,</span>
                        <span class="token property">&quot;expression&quot;</span><span class="token operator">:</span> <span class="token string">&quot;'None'&quot;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token property">&quot;hidden&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;BasicLens&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
            <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;lenses&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;all_exhibits&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token property">&quot;unionRelations&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token punctuation">[</span><span class="token string">&quot;lenses&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;historical_exhibits_extended&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token punctuation">[</span><span class="token string">&quot;lenses&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;nature_exhibits_extended&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token punctuation">[</span><span class="token string">&quot;art_exhibits&quot;</span><span class="token punctuation">]</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token property">&quot;provenanceColumn&quot;</span><span class="token operator">:</span> <span class="token string">&quot;exhibit_type&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;UnionLens&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="mapping-2"><a href="#mapping-2" class="header-anchor">#</a> Mapping</h3> <p>We can now extend the mapping file to also include artist names:</p> <div class="language-obda extra-class"><pre class="language-text"><code>mappingId	MAPID-exhibits
target		data:exhibit/{exhibit_id} a :Exhibit ; :name {name} ; :displayedIn data:museum/{museum_id} ; :exhibitType {exhibit_type} ; :artistName {artist_name} .
source		SELECT exhibit_id, name, museum_id, exhibit_type, artist_name FROM lenses.all_exhibits;
</code></pre></div><p>Now, running this slightly modified SPARQL query:</p> <div class="language-SPARQL extra-class"><pre class="language-sparql"><code><span class="token keyword">PREFIX</span> <span class="token function"><span class="token prefix"><span class="token punctuation">:</span></span></span> <span class="token url"><span class="token punctuation">&lt;</span>http://example.org/museum_kg/<span class="token punctuation">&gt;</span></span>
<span class="token keyword">SELECT</span> <span class="token variable">?name</span> <span class="token variable">?type</span> <span class="token variable">?artist</span> <span class="token keyword">WHERE</span> <span class="token punctuation">{</span>
    <span class="token variable">?exhibit</span> <span class="token keyword">a</span> <span class="token function"><span class="token prefix"><span class="token punctuation">:</span></span><span class="token local-name">Exhibit</span></span> <span class="token punctuation">.</span>
    <span class="token variable">?exhibit</span> <span class="token function"><span class="token prefix"><span class="token punctuation">:</span></span><span class="token local-name">name</span></span> <span class="token variable">?name</span> <span class="token punctuation">.</span>
    <span class="token variable">?exhibit</span> <span class="token function"><span class="token prefix"><span class="token punctuation">:</span></span><span class="token local-name">exhibitType</span></span> <span class="token variable">?type</span> <span class="token punctuation">.</span>
    <span class="token variable">?exhibit</span> <span class="token function"><span class="token prefix"><span class="token punctuation">:</span></span><span class="token local-name">artistName</span></span> <span class="token variable">?artist</span>
<span class="token punctuation">}</span>
</code></pre></div><p>we will once again get all earlier results, in addition to all exhibits contained in the <code>art_exhibit</code> table. While the earlier results will have the value <code>None</code> as their artist name, the <code>art_exhibits</code> entries will include the name of their artists.</p> <hr> <p>As a further exercise, notice how the values of <code>:exhibitType</code> are rather ugly: <code>&quot;art_exhibits&quot;</code>, <code>&quot;lenses.historical_exhibits_extended&quot;</code>, and <code>&quot;lenses.nature_exhibits_extended&quot;</code>. Try adding a new basic lens over the union lens that transforms these into the values <code>&quot;art&quot;</code>, <code>&quot;historical&quot;</code>, and <code>&quot;nature&quot;</code> instead.</p> <p><em>Hint: Look at the SQL function <code>REPLACE</code>. Could it be used in the <code>expression</code> field of an added column to get rid of the <code>_exhibits</code>, <code>_extended</code>, and <code>lenses.</code> part?</em></p> <p>Notice how the union lens allowed you to perform this operation on all three of its base relations by just defining it once. Without the union lens, you would have required three such basic lenses, one for each table, with the exact same contents.</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/ontop/ontop-website/edit/master/tutorial/lenses/union-lens.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">5/19/2023, 3:28:32 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/tutorial/lenses/join-lens.html" class="prev">
        Join Lens
      </a></span> <span class="next"><a href="/tutorial/lenses/flatten-lens.html">
        Flatten Lens
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.1383b214.js" defer></script><script src="/assets/js/2.ce8d9015.js" defer></script><script src="/assets/js/92.2f52313f.js" defer></script>
  </body>
</html>
